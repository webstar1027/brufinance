"use strict";(self.webpackChunkbrufinancev2=self.webpackChunkbrufinancev2||[]).push([["src_app_modules_nft_nft_module_ts"],{87054:(tt,x,d)=>{d.r(x),d.d(x,{NftModule:()=>K});var h=d(54364),l=d(1707),w=d(63873),T=d(71435),t=d(2316),Z=d(92435),b=d(22369),v=d(71306);function M(e,s){if(1&e){const o=t.EpF();t.TgZ(0,"p",8),t.NdJ("click",function(){return t.CHM(o),t.oxw().handleSubmitBorrow()}),t._uU(1,"Borrow"),t.qZA()}}function y(e,s){if(1&e){const o=t.EpF();t.TgZ(0,"p",9),t.NdJ("click",function(){return t.CHM(o),t.oxw().handleSubmitRepay()}),t._uU(1,"Repay"),t.qZA()}}function N(e,s){1&e&&t._UZ(0,"div",10)}function U(e,s){1&e&&t._UZ(0,"div",10)}let C=(()=>{class e{constructor(o,n){this.fb=o,this.chainlinkService=n,this.readOnly=!1,this.borrowEvent=new t.vpe,this.repayEvent=new t.vpe,this.borrowBtnClicked=!1,this.path="../../../../../assets/",this.borrowForm=this.fb.group({borrowAmount:[0],repayAmount:[0],nftId:[""],commodity:[""],quantity:[""],price:[""],borrowStatus:[""],amountBorrowed:[""],repaymentStatus:[""],amountRepaid:[""]})}ngOnInit(){}ngOnChanges(o){this.nft=Object.assign({},o.nft.currentValue),this.img=this.nft.commodity.replace("/","-"," ","-","  ","-"),console.log(this.nft);const{_id:n,commodity:i,quantity:r,nftPrice:a,borrowed:c,borrowedAmount:p,repaid:_,repaidAmount:m}=this.nft,f=this.chainlinkService.roundOffDecimal(this.chainlinkService.convertInrToUsd(a)),u=this.chainlinkService.roundOffDecimal(this.chainlinkService.convertInrToUsd(p)),g=this.chainlinkService.roundOffDecimal(this.chainlinkService.convertInrToUsd(m));this.borrowForm.patchValue({nftId:n,commodity:i,quantity:r,price:f,borrowStatus:c,amountBorrowed:u,repaymentStatus:_,amountRepaid:g})}handleSubmitBorrow(){this.borrowForm.invalid||this.borrowEvent.emit(this.nft)}handleSubmitRepay(){this.borrowForm.invalid||this.repayEvent.emit(this.nft)}convertDollarToMatic(o){return(.61728*o).toFixed(4)}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(l.qu),t.Y36(b.U))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-nft-card"]],inputs:{nft:"nft",readOnly:"readOnly"},outputs:{borrowEvent:"borrow",repayEvent:"repay"},features:[t.TTD],decls:16,vars:9,consts:[[1,"mainCard"],[1,"imageCard",3,"src"],[1,"cardTitle"],[1,"cardCard"],[1,"lightColorTheme","spanMainCard"],["class","mainBtn",3,"click",4,"ngIf"],["class","repayBtn",3,"click",4,"ngIf"],["class","Button",4,"ngIf"],[1,"mainBtn",3,"click"],[1,"repayBtn",3,"click"],[1,"Button"]],template:function(o,n){1&o&&(t.TgZ(0,"div",0),t._UZ(1,"img",1),t.TgZ(2,"p",2),t._uU(3),t.qZA(),t.TgZ(4,"p",3),t._uU(5,"Quantity : "),t.TgZ(6,"span",4),t._uU(7),t.qZA(),t.qZA(),t.TgZ(8,"p",3),t._uU(9,"Value : "),t.TgZ(10,"span",4),t._uU(11),t.qZA(),t.qZA(),t.YNc(12,M,2,0,"p",5),t.YNc(13,y,2,0,"p",6),t.YNc(14,N,1,0,"div",7),t.YNc(15,U,1,0,"div",7),t.qZA()),2&o&&(t.xp6(1),t.MGl("src","../../../../../assets/nft/",n.img,".jpg",t.LSH),t.xp6(2),t.Oqu(n.nft.commodity),t.xp6(4),t.hij("",n.nft.quantity," KGs"),t.xp6(4),t.AsE(" ",n.convertDollarToMatic(n.borrowForm.value.price)," MATIC ( $ ",n.borrowForm.value.price," )"),t.xp6(1),t.Q6J("ngIf",!n.nft.borrowed),t.xp6(1),t.Q6J("ngIf",!n.nft.repayed&&n.nft.borrowed),t.xp6(1),t.Q6J("ngIf",!n.readOnly),t.xp6(1),t.Q6J("ngIf",!n.nft.repayed&&n.nft.borrowed))},directives:[h.O5],styles:[".Card[_ngcontent-%COMP%]{margin:6px 4%;width:auto;height:520px;border:1px solid rgb(223 223 223);border-radius:10px;background:rgb(255,254,254);box-shadow:0 4px 8px -2px gray}.img[_ngcontent-%COMP%]{width:100%;height:274px;border-radius:5px;margin-bottom:4%}.val[_ngcontent-%COMP%]{margin-left:auto;margin-bottom:10px}.name[_ngcontent-%COMP%]{font-weight:500;font-size:12px}.form-control-plaintext[_ngcontent-%COMP%]{display:block;width:80%;padding:.375rem 0;margin-bottom:-9px;font-size:11px;font-weight:500;line-height:.5;color:#767b81;background-color:#fffefe;border:solid transparent;border-width:0px 0}.Button[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:130px;height:37px;border-radius:1.25rem;margin-bottom:0;position:relative;float:right;margin-right:11%;margin-top:-15px}.imageCard[_ngcontent-%COMP%]{width:100%;border-radius:6px;height:170px}.cardTitle[_ngcontent-%COMP%]{margin:12px 0;padding-left:3px}.cardCard[_ngcontent-%COMP%]{background-color:#f3f3f3;font-size:13px;padding:11px 9px;border-radius:5px;margin-bottom:4px}.lightColorTheme[_ngcontent-%COMP%]{color:#7c037b}.spanMainCard[_ngcontent-%COMP%]{float:right;padding-right:11px}.mainCard[_ngcontent-%COMP%]{padding:10px;border-radius:10px;box-shadow:0 0 8px #d2d2d2}.mainBtn[_ngcontent-%COMP%]{text-align:center;background-color:#540f7a;padding:10px;color:#fff;border-radius:6px;margin-top:15px;cursor:pointer}.repayBtn[_ngcontent-%COMP%]{text-align:center;background:#38B000D9;padding:10px;color:#fff;border-radius:6px;margin-top:15px;cursor:pointer}"]}),e})();function k(e,s){if(1&e&&(t.TgZ(0,"li",8),t._uU(1),t.qZA()),2&e){const o=s.$implicit,n=s.index;t.xp6(1),t.AsE(" ",n+1,". ",o.name," ")}}function S(e,s){if(1&e&&(t.TgZ(0,"div",11),t._UZ(1,"app-nft-card",12),t.qZA()),2&e){const o=s.$implicit;t.xp6(1),t.Q6J("readOnly",!0)("nft",o)}}function q(e,s){if(1&e&&(t.TgZ(0,"div",9),t.YNc(1,S,2,2,"div",10),t.qZA()),2&e){const o=t.oxw();t.xp6(1),t.Q6J("ngForOf",o.nfts)}}function O(e,s){1&e&&(t.TgZ(0,"div",13),t.TgZ(1,"div",14),t.TgZ(2,"span",15),t._uU(3,"Loading..."),t.qZA(),t.qZA(),t.qZA())}function I(e,s){if(1&e){const o=t.EpF();t.TgZ(0,"div",16),t.TgZ(1,"button",17),t.NdJ("click",function(){return t.CHM(o),t.oxw().handleShowMore()}),t._uU(2," Show more \u2192 "),t.qZA(),t.qZA()}}let F=(()=>{class e{constructor(o,n,i){this.nftService=o,this.chainlinkService=n,this.web3Service=i,this.fetchedData=!1,this.showSpinner=!1,this.nfts=[],this.totalAssets=0,this.totalAssetsValue=0,this.topCommodities=[],this.networkId=""}ngOnInit(){this.web3Service.bootstrapWeb3().subscribe(o=>{this.networkId=o[0]||"",this.loadData()},o=>{alert("Web3 bootstrap failed")})}loadData(o={}){this.showSpinner=!0,this.nftService.getAllNfts({skip:o.skip||this.nfts.length,limit:o.limit||10}).pipe((0,T.x)(()=>{this.fetchedData=!0,this.showSpinner=!1})).subscribe(r=>{this.totalAssets=r.totalAssets,this.totalAssetsValue=this.chainlinkService.roundOffDecimal(this.chainlinkService.convertInrToUsd(r.totalAssetsValue)),this.topCommodities=r.topCommodities,this.nfts=[...this.nfts,...r.data],console.log(this.nfts)})}handleShowMore(){this.loadData()}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(Z._),t.Y36(b.U),t.Y36(v.U))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-nft-list"]],decls:20,vars:6,consts:[[1,"p-4"],[1,"d-flex"],[1,"ml-auto"],[1,"list-unstyled"],["class","m-2",4,"ngFor","ngForOf"],["class","row",4,"ngIf"],["class","text-center p-3",4,"ngIf"],["class","text-center",4,"ngIf"],[1,"m-2"],[1,"row"],["class","col-md-3 p-3",4,"ngFor","ngForOf"],[1,"col-md-3","p-3"],[3,"readOnly","nft"],[1,"text-center","p-3"],["role","status",1,"spinner-border","text-primary"],[1,"sr-only"],[1,"text-center"],[1,"btn","btn-lg",3,"click"]],template:function(o,n){1&o&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t.TgZ(3,"h3"),t._uU(4,"Total Assets"),t.qZA(),t.TgZ(5,"h3"),t._uU(6),t.qZA(),t._UZ(7,"br"),t.TgZ(8,"h3"),t._uU(9,"Total Value of Assets"),t.qZA(),t.TgZ(10,"h3"),t._uU(11),t.qZA(),t._UZ(12,"br"),t.TgZ(13,"h3"),t._uU(14,"Top Commodities"),t.qZA(),t.TgZ(15,"ul",3),t.YNc(16,k,2,2,"li",4),t.qZA(),t.qZA(),t.qZA(),t.YNc(17,q,2,1,"div",5),t.YNc(18,O,4,0,"div",6),t.YNc(19,I,3,0,"div",7),t.qZA()),2&o&&(t.xp6(6),t.Oqu(n.totalAssets),t.xp6(5),t.hij("$ ",n.totalAssetsValue,""),t.xp6(5),t.Q6J("ngForOf",n.topCommodities),t.xp6(1),t.Q6J("ngIf",n.fetchedData),t.xp6(1),t.Q6J("ngIf",n.showSpinner),t.xp6(1),t.Q6J("ngIf",n.fetchedData))},directives:[h.sg,h.O5,C],styles:[""]}),e})();var A=d(45082),P=d(41121);function B(e,s){if(1&e){const o=t.EpF();t.TgZ(0,"div",10),t.TgZ(1,"app-nft-card",11),t.NdJ("borrow",function(i){t.CHM(o);const r=t.oxw(2),a=t.MAs(8);return r.handleBorrow(i,a)})("repay",function(i){t.CHM(o);const r=t.oxw(2),a=t.MAs(10);return r.handleRepay(i,a)}),t.qZA(),t.qZA()}if(2&e){const o=s.$implicit;t.xp6(1),t.Q6J("nft",o)}}function L(e,s){if(1&e&&(t.TgZ(0,"div",8),t.YNc(1,B,2,1,"div",9),t.qZA()),2&e){const o=t.oxw();t.xp6(1),t.Q6J("ngForOf",o.nfts)}}function R(e,s){1&e&&(t.TgZ(0,"div",12),t.TgZ(1,"div",13),t.TgZ(2,"span",14),t._uU(3,"Loading..."),t.qZA(),t.qZA(),t.qZA())}function J(e,s){if(1&e){const o=t.EpF();t.TgZ(0,"div",15),t.TgZ(1,"button",16),t.NdJ("click",function(){return t.CHM(o),t.oxw().handleShowMore()}),t._uU(2," Show more \u2192 "),t.qZA(),t.qZA()}}function Y(e,s){1&e&&(t.TgZ(0,"div"),t.TgZ(1,"p",17),t._uU(2,"No NFTs found"),t.qZA(),t.qZA())}function D(e,s){if(1&e){const o=t.EpF();t.TgZ(0,"div",19),t.TgZ(1,"i",20),t.NdJ("click",function(){return t.CHM(o),t.oxw().$implicit.dismiss("Cross Click")}),t.qZA(),t.TgZ(2,"h3",21),t._uU(3,"Borrowing Successful"),t.qZA(),t.TgZ(4,"div",22),t._UZ(5,"i",23),t.TgZ(6,"p",24),t._uU(7,"Transaction completed."),t.qZA(),t.qZA(),t.TgZ(8,"div",25),t.TgZ(9,"p",26),t._uU(10,"Borrowed: "),t.TgZ(11,"span",27),t._uU(12),t.qZA(),t.TgZ(13,"span",28),t._uU(14," MATIC"),t.qZA(),t.qZA(),t.TgZ(15,"p",29),t._uU(16,"Your borrowing is shown on the "),t.TgZ(17,"a",30),t.TgZ(18,"span",27),t._uU(19,"My NFTs"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(20,"p",31),t._uU(21,"You can also view the transaction on "),t.TgZ(22,"span",27),t._uU(23,"Polygon Blockchain"),t.qZA(),t.qZA(),t._UZ(24,"br"),t.TgZ(25,"div",32),t.TgZ(26,"button",33),t.NdJ("click",function(){return t.CHM(o),t.oxw(2).viewTransaction()}),t._uU(27," View on Polygon "),t.qZA(),t.qZA(),t.qZA()}if(2&e){const o=t.oxw(2);t.xp6(12),t.Oqu(o.borrowAmount)}}function E(e,s){if(1&e){const o=t.EpF();t.TgZ(0,"div",19),t.TgZ(1,"i",20),t.NdJ("click",function(){return t.CHM(o),t.oxw().$implicit.dismiss("Cross Click")}),t.qZA(),t.TgZ(2,"h3",21),t._uU(3,"Repayment Successful"),t.qZA(),t.TgZ(4,"div",22),t._UZ(5,"i",23),t.TgZ(6,"p",24),t._uU(7,"Transaction completed."),t.qZA(),t.qZA(),t.TgZ(8,"div",25),t.TgZ(9,"p",26),t._uU(10,"Repaid: "),t.TgZ(11,"span",27),t._uU(12),t.qZA(),t.TgZ(13,"span",28),t._uU(14," MATIC"),t.qZA(),t.qZA(),t.TgZ(15,"p",29),t._uU(16,"Your repayment is shown on the "),t.TgZ(17,"a",30),t.TgZ(18,"span",27),t._uU(19,"My NFTs"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(20,"p",31),t._uU(21,"You can also view the transaction on "),t.TgZ(22,"span",27),t._uU(23,"Polygon Blockchain"),t.qZA(),t.qZA(),t._UZ(24,"br"),t.TgZ(25,"div",32),t.TgZ(26,"button",33),t.NdJ("click",function(){return t.CHM(o),t.oxw(2).viewTransaction()}),t._uU(27," View on Polygon "),t.qZA(),t.qZA(),t.qZA()}if(2&e){const o=t.oxw(2);t.xp6(12),t.Oqu(o.repayAmount)}}function V(e,s){if(1&e&&(t.YNc(0,D,28,1,"div",18),t.YNc(1,E,28,1,"div",18)),2&e){const o=t.oxw();t.Q6J("ngIf",o.borrowSuccess),t.xp6(1),t.Q6J("ngIf",o.repaySuccess)}}function H(e,s){if(1&e){const o=t.EpF();t.TgZ(0,"p",46),t.NdJ("click",function(){t.CHM(o);const i=t.oxw(2),r=t.MAs(6);return i.handleSubmitBorrow("borrow",r)}),t._uU(1,"Borrow Now "),t.qZA()}}function Q(e,s){1&e&&(t.TgZ(0,"p",47),t._UZ(1,"i",48),t.qZA())}function z(e,s){if(1&e){const o=t.EpF();t.TgZ(0,"div",19),t.TgZ(1,"i",20),t.NdJ("click",function(){return t.CHM(o).$implicit.dismiss("Cross Click")}),t.qZA(),t.TgZ(2,"h3",21),t._uU(3,"Borrow"),t.qZA(),t.TgZ(4,"div",34),t.TgZ(5,"div",35),t._UZ(6,"img",36),t.TgZ(7,"p",37),t._uU(8,"You are lending "),t.TgZ(9,"span",27),t._uU(10,"MATIC"),t.qZA(),t._uU(11," against "),t.TgZ(12,"span",27),t._uU(13),t.qZA(),t._uU(14," stored in our warehouses"),t.qZA(),t.qZA(),t.TgZ(15,"div",38),t.TgZ(16,"p",39),t._uU(17,"Commodity Value : "),t.TgZ(18,"span",40),t._uU(19),t.qZA(),t.qZA(),t.TgZ(20,"p",41),t._uU(21,"Eligible Loan Amount : "),t.TgZ(22,"span",40),t._uU(23),t.qZA(),t.qZA(),t.TgZ(24,"p",42),t._uU(25,"Enter Loan Amount ( in MATIC ) : "),t.TgZ(26,"input",43),t.NdJ("ngModelChange",function(i){return t.CHM(o),t.oxw().borrowAmount=i})("ngModelChange",function(i){return t.CHM(o),t.oxw().calculateInterestandPlatformFees(i)}),t.qZA(),t.qZA(),t.TgZ(27,"p",39),t._uU(28,"Interest Applicable ( @13% p.a. ) : "),t.TgZ(29,"span",40),t._uU(30),t.qZA(),t.qZA(),t.TgZ(31,"p",39),t._uU(32,"Platform Fees ( @0.25% ) : "),t.TgZ(33,"span",40),t._uU(34),t.qZA(),t.qZA(),t.YNc(35,H,2,0,"p",44),t.YNc(36,Q,2,0,"p",45),t.qZA(),t.qZA(),t._UZ(37,"div"),t.qZA()}if(2&e){const o=t.oxw();t.xp6(6),t.MGl("src","../../../../../assets/nft/",o.img,".jpg",t.LSH),t.xp6(7),t.Oqu(o.selectedNft.commodity),t.xp6(6),t.AsE(" ",o.convertDollarToMatic(o.eligibleLoanAmount(o.borrowForm.value.price))," MATIC ( $ ",o.borrowForm.value.price," )"),t.xp6(4),t.hij("$ ",o.eligibleLoanAmount(o.borrowForm.value.price),""),t.xp6(3),t.Q6J("ngModel",o.borrowAmount),t.xp6(4),t.hij(" ",o.interestApplicable," MATIC"),t.xp6(4),t.hij(" ",o.platformFees," MATIC"),t.xp6(1),t.Q6J("ngIf",!o.showLoaderForBorrow),t.xp6(1),t.Q6J("ngIf",o.showLoaderForBorrow)}}function W(e,s){if(1&e){const o=t.EpF();t.TgZ(0,"p",53),t.NdJ("click",function(){t.CHM(o);const i=t.oxw(2),r=t.MAs(6);return i.handleSubmitRepay("repay",r)}),t._uU(1," Repay Now "),t.qZA()}}function j(e,s){1&e&&(t.TgZ(0,"p",54),t._UZ(1,"i",48),t.qZA())}function $(e,s){if(1&e){const o=t.EpF();t.TgZ(0,"div",19),t.TgZ(1,"i",20),t.NdJ("click",function(){return t.CHM(o).$implicit.dismiss("Cross Click")}),t.qZA(),t.TgZ(2,"h3",21),t._uU(3,"Repay"),t.qZA(),t.TgZ(4,"div",34),t.TgZ(5,"div",35),t._UZ(6,"img",36),t.TgZ(7,"p",37),t._uU(8,"You are repaying the amount you borrowed against "),t.TgZ(9,"span",27),t._uU(10),t.qZA(),t._uU(11," earlier."),t.qZA(),t.qZA(),t.TgZ(12,"div",38),t.TgZ(13,"p",49),t._uU(14,"Commodity Value : "),t.TgZ(15,"span",40),t._uU(16),t.qZA(),t.qZA(),t.TgZ(17,"p",50),t._uU(18,"Repayment Amount ( in MATIC ) : "),t.TgZ(19,"input",43),t.NdJ("ngModelChange",function(i){return t.CHM(o),t.oxw().repayAmount=i})("ngModelChange",function(i){return t.CHM(o),t.oxw().calculateInterestandTotalAmount(i)}),t.qZA(),t.qZA(),t.TgZ(20,"p",39),t._uU(21,"Interest Applicable ( @13% p.a. ) : "),t.TgZ(22,"span",40),t._uU(23),t.qZA(),t.qZA(),t.TgZ(24,"p",39),t._uU(25,"Total Repayment Amount : "),t.TgZ(26,"span",40),t._uU(27),t.qZA(),t.qZA(),t.YNc(28,W,2,0,"p",51),t.YNc(29,j,2,0,"p",52),t.qZA(),t.qZA(),t._UZ(30,"div"),t.qZA()}if(2&e){const o=t.oxw();t.xp6(6),t.MGl("src","../../../../../assets/nft/",o.img,".jpg",t.LSH),t.xp6(4),t.Oqu(o.selectedNft.commodity),t.xp6(6),t.AsE(" ",o.convertDollarToMatic(o.eligibleLoanAmount(o.borrowForm.value.price))," MATIC ( $ ",o.borrowForm.value.price," )"),t.xp6(3),t.Q6J("ngModel",o.repayAmount),t.xp6(4),t.hij(" ",o.interestApplicableRepay," MATIC"),t.xp6(4),t.hij(" ",o.totalRepaymentAmount," MATIC"),t.xp6(1),t.Q6J("ngIf",!o.showLoaderForRepay),t.xp6(1),t.Q6J("ngIf",o.showLoaderForRepay)}}const G=[{path:"all",component:F},{path:"my",component:(()=>{class e{constructor(o,n,i,r,a){this.nftService=o,this.web3Service=n,this.chainlinkService=i,this.modalService=r,this.fb=a,this.fetchedData=!1,this.showSpinner=!1,this.nfts=[],this.totalAssets=0,this.interestApplicable=0,this.interestApplicableRepay=0,this.totalRepaymentAmount=0,this.platformFees=0,this.readOnly=!1,this.totalAssetsValue=0,this.topCommodities=[],this.networkId="",this.showLoaderForRepay=!1,this.showLoaderForBorrow=!1,this.borrowSuccess=!1,this.repaySuccess=!1,this.borrowAmount=0,this.repayAmount=0,this.maticurl="https://mumbai.polygonscan.com/tx/",this.borrowForm=this.fb.group({borrowAmount:[0],repayAmount:[0],nftId:[""],commodity:[""],quantity:[""],price:[""],borrowStatus:[""],amountBorrowed:[""],repaymentStatus:[""],amountRepayed:[""]})}ngOnChanges(o){console.log(o.amount.currentValue)}ngOnInit(){this.web3Service.bootstrapWeb3().subscribe(o=>{this.networkId=o[0]||"",this.loadData()},o=>{alert("Web3 bootstrap failed")})}updateNFTVal(){this.img=this.selectedNft.commodity.replace("/","-"," ","-","  ","-"),console.log(this.selectedNft);const{_id:o,commodity:n,quantity:i,nftPrice:r,borrowed:a,borrowedAmount:c,repaid:p,repaidAmount:_}=this.selectedNft,m=this.chainlinkService.roundOffDecimal(this.chainlinkService.convertInrToUsd(r)),f=this.chainlinkService.roundOffDecimal(this.chainlinkService.convertInrToUsd(_)),u=this.web3Service.convertToLargestUnit(c)+" MATIC";this.borrowForm.patchValue({nftId:o,commodity:n,quantity:i,price:m,borrowStatus:a,amountBorrowed:u,repaymentStatus:p,amountRepaid:f}),a?this.borrowForm.controls.repayAmount.addValidators([l.kI.required,l.kI.min(1),l.kI.max(c)]):this.borrowForm.controls.borrowAmount.addValidators([l.kI.required,l.kI.min(1),l.kI.max(Math.round(100*(.7*m+Number.EPSILON))/100)])}loadData(o={}){this.networkId?(this.showSpinner=!0,this.nftService.getAllNfts({skip:o.skip||this.nfts.length,limit:o.limit||10,networkId:this.networkId}).pipe((0,T.x)(()=>{this.fetchedData=!0,this.showSpinner=!1})).subscribe(c=>{this.totalAssets=c.totalAssets,this.totalAssetsValue=this.chainlinkService.roundOffDecimal(this.chainlinkService.convertInrToUsd(c.totalAssetsValue)),this.topCommodities=c.topCommodities,this.nfts=[...this.nfts,...c.data]})):alert("Web3 network id not found")}handleBorrow(o,n){console.log(o),this.modalService.open(n,{windowClass:"BorrowModal",backdrop:"static",keyboard:!1}),this.selectedNft=o,this.updateNFTVal()}handleRepay(o,n){console.log(o),this.modalService.open(n,{windowClass:"BorrowModal",backdrop:"static",keyboard:!1}),this.selectedNft=o,this.updateNFTVal()}handleSubmitRepay(o,n){this.eventName={name:o,modal:n},this.chainlinkService.roundOffDecimal(this.chainlinkService.convertUsdToInr(this.repayAmount)),this.showLoaderForRepay=!0,console.log("internal brepya"),this.web3Service.artifactsToContractV2().methods.getTokenId(this.selectedNft._id).call().then(r=>{this.web3Service.artifactsToContractV2().methods.getBorrowDetails(r).call().then(a=>{const m=this.getBorrowInterest(a);console.log(m,"Borrow amount");const u=this.chainlinkService.convertEthToWei(this.repayAmount+m);console.log(u,"repay amount"),this.web3Service.artifactsToContractV2().methods.repay(r,Math.round(m*10**18)).send({from:this.web3Service.getAccount(),gas:"210000",value:u}).then(g=>{console.log("borrow agins nft",g),this.urlToViewTransaction=this.maticurl+g.transactionHash,this.borrowSuccess=!1,this.repaySuccess=!0,this.showLoaderForRepay=!1,this.modalService.open(n,{backdrop:"static",keyboard:!1}),this.updateNft(this.borrowForm.value.nftId,{repayed:!0,repayedAmount:u})}).catch(g=>{this.showLoaderForRepay=!1,console.log(g,"Error in while repaying",g)})})})}getBorrowInterest(o){let a,r=(Math.round((new Date).getTime()/1e3)-parseInt(o[1]))/86400;return r=1,a=1*parseFloat(this.web3Service.convertToLargestUnit(o[0]))*.13/365,a}handleSubmitBorrow(o,n){this.eventName={name:o,modal:n},console.log("INTERNAL BORROW");const i=this.web3Service.convertToSmallestUnit("0.03");console.log(i,"amount iwei"),this.showLoaderForBorrow=!0,this.web3Service.artifactsToContractV2().methods.getTokenId(this.selectedNft._id).call().then(a=>{console.log(a,"token id");const c=this.chainlinkService.convertEthToWei(this.borrowAmount);console.log(c,"amount to borrow"),this.web3Service.artifactsToContractV2().methods.borrow(c,a).send({from:this.web3Service.getAccount(),gas:"210000"}).then(p=>{this.showLoaderForBorrow=!1,console.log("borrow agins nft",p),this.urlToViewTransaction=this.maticurl+p.transactionHash,this.updateNft(this.borrowForm.value.nftId,{borrowed:!0,borrowedAmount:c}),this.modalService.open(n,{backdrop:"static",keyboard:!1}),this.borrowSuccess=!0}).catch(p=>{this.showLoaderForBorrow=!1,console.log("Error while borrowing",p)})});const r={nftId:this.borrowForm.value.nftId,borrowAmount:this.chainlinkService.roundOffDecimal(this.chainlinkService.convertUsdToInr(this.borrowForm.value.borrowAmount))};console.log(r),this.showLoaderForBorrow=!0}handleShowMore(){this.loadData()}borrowInternal(o,n){const i=this.chainlinkService.roundOffDecimal(this.chainlinkService.convertInrToUsd(o),8),r=this.chainlinkService.convertUsdToEth(i),a=this.chainlinkService.convertEthToWei(r);this.nftService.borrowInternal(a,n,A.N.ABI.networks[3].address).then(p=>{console.log(p),this.urlToViewTransaction=this.maticurl+p.transactionHash,this.updateNft(n,{borrowed:!0,borrowedAmount:o})}).catch(p=>{this.showLoaderForRepay=!1,console.log(p)})}repayBorrowInternal(o,n){const i=this.chainlinkService.roundOffDecimal(this.chainlinkService.convertInrToUsd(o),8),r=this.chainlinkService.convertUsdToEth(i),a=this.chainlinkService.convertEthToWei(r),c=A.N.ABI.networks[3].address;console.log({amount:o,usdRepay:i,usdEth:r,ethWei:a}),this.nftService.repayBorrowInternal(a,n,c).then(p=>{console.log(p),this.urlToViewTransaction=this.maticurl+p.transactionHash,this.updateNft(n,{repayed:!0,repayedAmount:o})}).catch(p=>{this.showLoaderForRepay=!1,console.log(p)})}updateNft(o,n){this.nftService.updateNft(o,n).subscribe(i=>{const r=this.nfts.findIndex(a=>a._id===o);this.nfts[r]=i.data,this.selectedNft=i.data,this.modalService.dismissAll(),"repay"===this.eventName.name&&this.modalService.open(this.eventName.modal),"borrow"===this.eventName.name&&this.modalService.open(this.eventName.modal),this.updateNFTVal(),this.showLoaderForRepay=!1,this.showLoaderForBorrow=!1})}viewTransaction(){this.urlToViewTransaction&&window.open(this.urlToViewTransaction,"_blank")}convertDollarToMatic(o){return(o*this.chainlinkService.priceConversions.maticUsd).toFixed(4)}eligibleLoanAmount(o){return(.7*o).toFixed(4)}calculateInterestandPlatformFees(o){console.log(o),this.borrowAmount=o,this.borrowAmount&&(this.interestApplicable=(.13*this.borrowAmount).toFixed(4),this.platformFees=(.0025*this.borrowAmount).toFixed(4))}calculateInterestandTotalAmount(o){console.log(o),this.repayAmount=o,this.repayAmount&&(this.interestApplicableRepay=(.13*this.repayAmount).toFixed(4),this.totalRepaymentAmount=(Number(this.interestApplicableRepay)+Number(this.repayAmount)).toFixed(4))}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(Z._),t.Y36(v.U),t.Y36(b.U),t.Y36(P.FF),t.Y36(l.qu))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-user-nfts"]],inputs:{amount:"amount"},features:[t.TTD],decls:11,vars:4,consts:[[1,"p-4"],["class","row",4,"ngIf"],["class","text-center p-3",4,"ngIf"],["class","text-center",4,"ngIf"],[4,"ngIf"],["successModal",""],["borrowM",""],["repayM",""],[1,"row"],["class","col-md-3 p-3",4,"ngFor","ngForOf"],[1,"col-md-3","p-3"],[3,"nft","borrow","repay"],[1,"text-center","p-3"],["role","status",1,"spinner-border","text-primary"],[1,"sr-only"],[1,"text-center"],[1,"btn","btn-lg",3,"click"],[1,"text-center","m-3"],["class","modal-body p-4 deposit-modal",4,"ngIf"],[1,"modal-body","p-4","deposit-modal"],["data-dismiss","modal",1,"fa","fa-times","closeeBtn",3,"click"],[1,"modalH3"],[1,"successModaldivPSuccess"],[1,"fa","fa-check-circle","depositSUccessPIcon"],[1,"depositSuccessModalPL"],[1,"successModaldiv"],[1,"youDepositedMsg",2,"text-align","center"],[1,"lightColorTheme"],[1,"darkColorTheme"],[1,"successModaldivP","youDepositedSubMsg"],["href","/nfts/my",2,"color","#7C037B"],[2,"margin-bottom","0","text-align","center"],[2,"text-align","center"],[1,"button","button--deposit",3,"click"],[1,"row","mainRow"],[1,"width40",2,"width","42%"],[2,"width","88%","height","178px","border-radius","8px",3,"src"],[1,"highlightTextModal"],[1,"width60",2,"width","58%"],[1,"pModalTxt"],[1,"lightColorTheme","spanMainCard"],[1,"pEligibleAmount"],[1,"pModalTxt",2,"margin-bottom","24px","margin-top","20px"],["type","number",1,"inputLoanAmount",2,"margin-top","-6px",3,"ngModel","ngModelChange"],["class","mainBtn",3,"click",4,"ngIf"],["class","mainBtn",4,"ngIf"],[1,"mainBtn",3,"click"],[1,"mainBtn"],[1,"fa","fa-spin","fa-circle-o-notch"],[1,"pModalTxt",2,"border-bottom","dashed #e4e4e4","padding-bottom","20px","margin-bottom","22px"],[1,"pModalTxt",2,"margin-bottom","24px","margin-top","13px"],["style","margin-top: 12%;","class","mainBtn repayBtn",3,"click",4,"ngIf"],["style","margin-top: 12%;","class","mainBtn repayBtn",4,"ngIf"],[1,"mainBtn","repayBtn",2,"margin-top","12%",3,"click"],[1,"mainBtn","repayBtn",2,"margin-top","12%"]],template:function(o,n){1&o&&(t.TgZ(0,"div",0),t.YNc(1,L,2,1,"div",1),t.YNc(2,R,4,0,"div",2),t.YNc(3,J,3,0,"div",3),t.YNc(4,Y,3,0,"div",4),t.qZA(),t.YNc(5,V,2,2,"ng-template",null,5,t.W1O),t.YNc(7,z,38,10,"ng-template",null,6,t.W1O),t.YNc(9,$,31,9,"ng-template",null,7,t.W1O)),2&o&&(t.xp6(1),t.Q6J("ngIf",n.fetchedData),t.xp6(1),t.Q6J("ngIf",n.showSpinner),t.xp6(1),t.Q6J("ngIf",n.fetchedData&&n.nfts.length),t.xp6(1),t.Q6J("ngIf",n.fetchedData&&!n.nfts.length&&!n.showSpinner))},directives:[h.O5,h.sg,C,l.wV,l.Fj,l.JJ,l.On],styles:[".form-control-plaintext[_ngcontent-%COMP%]{outline:none!important}.commImage[_ngcontent-%COMP%]{width:126px;border-radius:50%;position:absolute;top:-14px;right:38px;height:120px}.col[_ngcontent-%COMP%]{font-weight:500!important}.btn-primary[_ngcontent-%COMP%]{width:100%}.Mheader[_ngcontent-%COMP%]{width:100%}.Mheader[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{display:inline-block;width:50%}.modal-header[_ngcontent-%COMP%]{padding-bottom:0;border:none}.processLoader[_ngcontent-%COMP%]{position:absolute;display:inline-block;top:10px;right:10px}.spinner-border-Loader[_ngcontent-%COMP%]{width:25px!important;height:25px!important}.form-control[_ngcontent-%COMP%]{width:75%!important}.viewTrans[_ngcontent-%COMP%]{margin-bottom:0;font-size:14px;color:green;text-decoration:underline}.transactionSuccessImg[_ngcontent-%COMP%]{width:116px;border-radius:50%;margin-bottom:5%}.fa-times[_ngcontent-%COMP%]{font-size:19px!important}.modalPText[_ngcontent-%COMP%]{padding-left:10px;font-size:17px}.successModaldiv[_ngcontent-%COMP%]{background-color:#efe5f4;margin:20px 14px;border-radius:10px;padding:7px}.successModaldivP[_ngcontent-%COMP%]{background-color:#d9c2e4}.successModaldivPSuccess[_ngcontent-%COMP%]{background-color:#d7efcc;margin:20px 14px;border-radius:10px;padding:7px}.depositSuccessModalPL[_ngcontent-%COMP%]{padding:6px 6% 6px 17%;font-size:19px;margin-bottom:0;text-align:left;word-spacing:1px}.depositSUccessPIcon[_ngcontent-%COMP%]{font-size:46px;color:#51b02b;margin-top:11px;position:absolute;left:33px}.youDepositedMsg[_ngcontent-%COMP%]{margin-bottom:5px;font-size:22px;word-spacing:3px;letter-spacing:.4px}.youDepositedSubMsg[_ngcontent-%COMP%]{text-align:center;border-radius:4px;padding:6px;margin:5px 5px 3px}.spanMainCard[_ngcontent-%COMP%]{float:right;padding-right:11px}.lightColorTheme[_ngcontent-%COMP%]{color:#7c037b}.floatingBubble1[_ngcontent-%COMP%]{top:30%;right:21%}.floatingBubble2[_ngcontent-%COMP%]{bottom:15%;left:38%}.PtextDeposit2[_ngcontent-%COMP%]{display:inline-block;width:30%;margin:6% 6% 6% 12%}.modalH3[_ngcontent-%COMP%]{padding:18px;text-align:center;margin-bottom:0;background:linear-gradient(29deg,rgb(224 143 244 / 31%) .11%,rgb(146 70 177 / 22%) 100%);border-top-left-radius:19px;border-top-right-radius:19px}.modal-content[_ngcontent-%COMP%]{border-radius:19px!important;border:none!important}.modal-body[_ngcontent-%COMP%]{padding:0!important;border-radius:19px!important}.modalClasssText[_ngcontent-%COMP%]{border-radius:10px;padding:10px;background-color:#a670c03b;margin:22px 23px 10px;word-spacing:2px;letter-spacing:.5px}.mainRow[_ngcontent-%COMP%]{width:100%;margin:0;padding:13px}.BorrowModal[_ngcontent-%COMP%]   .modal-dialog[_ngcontent-%COMP%]{width:750px!important}.RepayModal[_ngcontent-%COMP%]   .modal-dialog[_ngcontent-%COMP%]{width:750px!important}.repayModalDescription[_ngcontent-%COMP%]{margin-top:10px;padding:10px;background:rgba(166,112,192,.18);border-radius:16px}.pModalTxt[_ngcontent-%COMP%]{margin-bottom:17px}.pEligibleAmount[_ngcontent-%COMP%]{border-bottom:dashed #dbdbdb;padding-bottom:10px;margin-bottom:8px}.mainBtn[_ngcontent-%COMP%]{text-align:center;background-color:#540f7a;padding:15px;color:#fff;border-radius:6px;margin-top:25px;cursor:pointer;margin-bottom:4px}.repayBtn[_ngcontent-%COMP%]{background-color:#38b000!important}.inputLoanAmount[_ngcontent-%COMP%]{width:34%;float:right;border-radius:5px;border:1px solid #c7c7c7;font-size:16px;padding:5px 5px 5px 10px}.highlightTextModal[_ngcontent-%COMP%]{padding:10px;text-align:left;background-color:#a670c02b;border-radius:10px;width:89%;margin-top:5%;word-spacing:5px;letter-spacing:.3px}.button--deposit[_ngcontent-%COMP%]{color:#fff;background-color:#540f7a;width:96%;margin-bottom:4%;padding:13px;border-radius:8px;font-size:19px}.button--withdraw[_ngcontent-%COMP%]{color:#fff;background-color:#540f7a;width:96%;margin-bottom:4%;padding:13px;border-radius:8px;font-size:19px}"]}),e})()}];let X=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[w.Bz.forChild(G)],w.Bz]}),e})(),K=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({providers:[],imports:[[h.ez,l.UX,X,l.u5]]}),e})()}}]);
//# sourceMappingURL=src_app_modules_nft_nft_module_ts.js.map